<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Durak vs Bot</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body {
            background-color: #2e7d32;
            color: white;
            font-family: sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* –ë–û–¢ –ê–ô–ú–ê“í–´ (–ñ–æ“ì–∞—Ä—ã) */
        #bot-area {
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.2);
            position: relative;
        }
        
        /* –ö–û–ó–´–†–¨ –ñ”ò–ù–ï –ö–û–õ–û–î–ê */
        #deck-area {
            position: absolute;
            left: 10px;
            top: 10px;
            display: flex;
            align-items: center;
        }

        /* “Æ–°–¢–ï–õ (–û—Ä—Ç–∞) */
        #table-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* –ú–ï–ù–Ü“¢ –ê–ô–ú–ê“í–´–ú (–¢”©–º–µ–Ω) */
        #my-area {
            height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 10px;
            background: linear-gradient(transparent, rgba(0,0,0,0.5));
        }

        .controls { display: flex; gap: 10px; margin-bottom: 10px; }
        
        button {
            padding: 8px 20px;
            border: none;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn-take { background: #f1c40f; }
        .btn-bita { background: #e74c3c; color: white; }
        .btn-new { background: #3498db; color: white; }

        /* –ö–ê–†–¢–ê –°–¢–ò–õ–Ü */
        .card {
            width: 60px;
            height: 90px;
            background: white;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 4px;
            box-shadow: 1px 1px 4px rgba(0,0,0,0.5);
            font-weight: bold;
            font-size: 14px;
            position: relative;
        }
        .card.red { color: red; }
        .card.black { color: black; }
        
        /* –ö–∞—Ä—Ç–∞–Ω—ã“£ –∞—Ä“õ–∞—Å—ã */
        .card-back {
            background: repeating-linear-gradient(45deg, #c0392b, #c0392b 10px, #e74c3c 10px, #e74c3c 20px);
            border: 2px solid white;
        }

        /* –ö–æ–∑—ã—Ä—å –∫–∞—Ä—Ç–∞—Å—ã (–∂–∞—Ç—ã“õ —Ç“±—Ä–∞–¥—ã) */
        .trump-card {
            transform: rotate(90deg);
            margin-left: -20px;
            z-index: 0;
        }
        .deck-stack {
            z-index: 1;
        }

        #message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 10px;
            display: none;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="bot-area">
        <div id="deck-area">
            <div id="trump-placeholder"></div> <div class="card card-back deck-stack" id="deck-count">36</div>
        </div>
        <div id="bot-hand" style="display:flex;"></div>
    </div>

    <div id="message-box">–•–∞–±–∞—Ä–ª–∞–º–∞</div>

    <div id="table-area"></div>

    <div id="my-area">
        <div class="controls">
            <button class="btn-take" onclick="socket.emit('actionTake')">–ê–õ–£</button>
            <button class="btn-bita" onclick="socket.emit('actionBita')">–ë–ò–¢–ê üóëÔ∏è</button>
            <button class="btn-new" onclick="socket.emit('restart')">üîÑ</button>
        </div>
        <div id="my-hand" style="display:flex; justify-content:center;"></div>
    </div>

    <script>
        const socket = io();
        
        // HTML —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä
        const myHandDiv = document.getElementById('my-hand');
        const botHandDiv = document.getElementById('bot-hand');
        const tableDiv = document.getElementById('table-area');
        const trumpDiv = document.getElementById('trump-placeholder');
        const deckCountDiv = document.getElementById('deck-count');
        const msgBox = document.getElementById('message-box');

        function createCard(card, isFaceUp, onClick = null) {
            const el = document.createElement('div');
            if (!isFaceUp) {
                el.className = 'card card-back';
                el.style.margin = '0 -20px';
                return el;
            }
            const isRed = (card.suit === '‚ô•' || card.suit === '‚ô¶') ? 'red' : 'black';
            el.className = `card ${isRed}`;
            if (onClick) {
                el.style.cursor = 'pointer';
                el.onclick = onClick;
                el.style.margin = '0 -10px';
                el.onmouseover = () => el.style.transform = 'translateY(-15px)';
                el.onmouseout = () => el.style.transform = 'translateY(0)';
            } else {
                el.style.margin = '0 5px'; // “Æ—Å—Ç–µ–ª–¥–µ–≥—ñ –∫–∞—Ä—Ç–∞
            }

            el.innerHTML = `
                <div>${card.value}</div>
                <div style="font-size:20px; text-align:center">${card.suit}</div>
                <div style="transform: rotate(180deg); text-align:right">${card.value}</div>
            `;
            return el;
        }

        socket.on('updateState', (state) => {
            // 1. –ú–µ–Ω—ñ“£ “õ–æ–ª—ã–º
            myHandDiv.innerHTML = '';
            state.playerHand.forEach((card, index) => {
                myHandDiv.appendChild(createCard(card, true, () => {
                    socket.emit('playCard', index);
                }));
            });

            // 2. –ë–æ—Ç—Ç—ã“£ “õ–æ–ª—ã (—Ç–µ–∫ —Å–∞–Ω—ã)
            botHandDiv.innerHTML = '';
            for(let i=0; i<state.botCardCount; i++) {
                botHandDiv.appendChild(createCard(null, false));
            }

            // 3. “Æ—Å—Ç–µ–ª
            tableDiv.innerHTML = '';
            state.table.forEach(card => {
                tableDiv.appendChild(createCard(card, true));
            });

            // 4. –ö–æ–∑—ã—Ä—å –∂”ô–Ω–µ –ö–æ–ª–æ–¥–∞
            trumpDiv.innerHTML = '';
            if (state.trumpCard) {
                const tCard = createCard(state.trumpCard, true);
                tCard.classList.add('trump-card');
                trumpDiv.appendChild(tCard);
            }
            deckCountDiv.innerText = state.deckCount;
            if(state.deckCount === 0) deckCountDiv.style.opacity = 0;
        });

        socket.on('message', (text) => {
            msgBox.innerText = text;
            msgBox.style.display = 'block';
            setTimeout(() => msgBox.style.display = 'none', 1500);
        });

    </script>
</body>
</html>
